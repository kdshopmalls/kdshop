<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layouts/layout}">
  <th:block layout:fragment="css">
    <style>
      :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --success-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        --card-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        --card-shadow-hover: 0 12px 35px rgba(0, 0, 0, 0.15);
      }

      .page-header {
        background: var(--primary-gradient);
        color: white;
        padding: 40px 0;
        margin-bottom: 40px;
        border-radius: 0 0 30px 30px;
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
      }

      .page-header h3 {
        font-size: 2.2rem;
        font-weight: 700;
        margin: 0;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      }

      .product-card {
        border: none;
        border-radius: 20px;
        padding: 0;
        margin-bottom: 30px;
        background: white;
        box-shadow: var(--card-shadow);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        overflow: hidden;
      }

      .product-card:hover {
        transform: translateY(-8px);
        box-shadow: var(--card-shadow-hover);
      }

      .product-card.out-of-stock {
        opacity: 0.7;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      }

      .product-image-wrapper {
        position: relative;
        overflow: hidden;
        border-radius: 20px 20px 0 0;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      }

      .product-image {
        width: 100%;
        height: 280px;
        object-fit: cover;
        transition: transform 0.5s ease;
      }

      .product-card:hover .product-image {
        transform: scale(1.08);
      }

      .stock-badge {
        position: absolute;
        top: 15px;
        right: 15px;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .stock-badge.in-stock {
        background: linear-gradient(135deg, #81fbb8 0%, #28c76f 100%);
        color: white;
      }

      .stock-badge.out-of-stock {
        background: linear-gradient(135deg, #fda085 0%, #f6d365 100%);
        color: white;
      }

      .product-content {
        padding: 25px;
      }

      .product-title {
        font-size: 1.3rem;
        font-weight: 700;
        color: #2d3748;
        margin-bottom: 12px;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        transition: color 0.3s ease;
      }

      .product-card:hover .product-title {
        color: #667eea;
      }

      .product-price {
        font-size: 1.6rem;
        font-weight: 800;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 15px;
      }

      .quantity-control {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 20px;
      }

      .quantity-control label {
        font-size: 0.9rem;
        font-weight: 600;
        color: #4a5568;
        margin: 0;
      }

      .quantity-input {
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        padding: 8px 12px;
        width: 80px;
        text-align: center;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .quantity-input:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        outline: none;
      }

      .action-buttons {
        display: flex;
        gap: 10px;
      }

      .btn-custom {
        flex: 1;
        padding: 12px 20px;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        font-size: 0.95rem;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .btn-custom::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.3);
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
      }

      .btn-custom:hover::before {
        width: 300px;
        height: 300px;
      }

      .btn-cart {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      }

      .btn-cart:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
      }

      .btn-buy {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(245, 87, 108, 0.3);
      }

      .btn-buy:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(245, 87, 108, 0.4);
      }

      .btn-custom:disabled {
        background: linear-gradient(135deg, #cbd5e0 0%, #a0aec0 100%);
        cursor: not-allowed;
        transform: none !important;
        box-shadow: none !important;
      }

      .pagination {
        margin-top: 50px;
      }

      .pagination .page-item .page-link {
        border: none;
        color: #667eea;
        font-weight: 600;
        padding: 12px 18px;
        margin: 0 5px;
        border-radius: 12px;
        transition: all 0.3s ease;
        background: white;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      }

      .pagination .page-item .page-link:hover {
        background: var(--primary-gradient);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      }

      .pagination .page-item.active .page-link {
        background: var(--primary-gradient);
        color: white;
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
      }

      @media (max-width: 768px) {
        .page-header h3 {
          font-size: 1.8rem;
        }

        .product-image {
          height: 220px;
        }

        .product-title {
          font-size: 1.1rem;
        }

        .product-price {
          font-size: 1.4rem;
        }

        .action-buttons {
          flex-direction: column;
        }
      }

      /* Î°úÎî© Ïï†ÎãàÎ©îÏù¥ÏÖò */
      @keyframes shimmer {
        0% {
          background-position: -1000px 0;
        }
        100% {
          background-position: 1000px 0;
        }
      }

      .product-card::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        animation: shimmer 2s infinite;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s;
      }

      .product-card:hover::after {
        opacity: 1;
      }
    </style>
  </th:block>

  <th:block layout:fragment="content">
    <div class="container-fluid" style="max-width: 1400px">
      <!-- Ìó§Îçî -->
      <div class="page-header">
        <div class="text-center">
          <h3 th:utext="${cate_name}">Ïπ¥ÌÖåÍ≥†Î¶¨</h3>
        </div>
      </div>

      <!-- ÏÉÅÌíà Í∑∏Î¶¨Îìú -->
      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        <div class="col" th:each="productDTO : ${secodCateGoryList}">
          <div class="product-card" th:classappend="${productDTO.item_amount == 0} ? 'out-of-stock'">
            <!-- Ïù¥ÎØ∏ÏßÄ ÏòÅÏó≠ -->
            <div class="product-image-wrapper">
              <a href="#" class="pro_info" th:data-item_num="${productDTO.item_num}">
                <img th:src="|/product/image_display?dateFolderName=${productDTO.item_up_folder}&fileName=s_${productDTO.item_img}|" class="product-image" alt="ÏÉÅÌíà Ïù¥ÎØ∏ÏßÄ" />
              </a>

              <!-- Ïû¨Í≥† Î±ÉÏßÄ -->
              <div th:if="${productDTO.item_amount > 0}" class="stock-badge in-stock"><span>Ïû¨Í≥† </span><span th:text="${productDTO.item_amount}"></span><span>Í∞ú</span></div>
              <div th:if="${productDTO.item_amount == 0}" class="stock-badge out-of-stock">ÌíàÏ†à</div>
            </div>

            <!-- ÏÉÅÌíà Ï†ïÎ≥¥ -->
            <div class="product-content">
              <a href="#" class="pro_info text-decoration-none" th:data-item_num="${productDTO.item_num}">
                <h5 class="product-title" th:text="${productDTO.item_name}">ÏÉÅÌíàÎ™Ö</h5>
              </a>

              <div class="product-price" th:text="${#numbers.formatInteger(productDTO.item_price, 3, 'COMMA')} + 'Ïõê'"></div>

              <!-- ÏàòÎüâ ÏÑ†ÌÉù -->
              <div th:if="${productDTO.item_amount > 0}" class="quantity-control">
                <label>ÏàòÎüâ</label>
                <input type="number" class="quantity-input" name="quantity" value="1" min="1" th:attr="max=${productDTO.item_amount}" />
              </div>

              <!-- Î≤ÑÌäº ÏòÅÏó≠ -->
              <div class="action-buttons">
                <form th:action="@{/cart/add}" method="post" style="flex: 1">
                  <input type="hidden" name="item_num" th:value="${productDTO.item_num}" />
                  <input type="hidden" name="quantity" value="1" class="selected-qty" />
                  <button type="button" name="brn_cart_add" th:data-item_num="${productDTO.item_num}" class="btn-custom btn-cart w-100" th:disabled="${productDTO.item_amount == 0}">
                    üõí Ïû•Î∞îÍµ¨Îãà
                  </button>
                </form>

                <form th:action="@{/order/now}" method="post" style="flex: 1">
                  <input type="hidden" name="item_num" th:value="${productDTO.item_num}" />
                  <input type="hidden" name="quantity" value="1" class="selected-qty" />
                  <button type="button" name="btn_buy_add" class="btn-custom btn-buy w-100" th:data-item_num="${productDTO.item_num}" th:disabled="${productDTO.item_amount == 0}">üí≥ Íµ¨Îß§ÌïòÍ∏∞</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò -->
      <div class="row mt-4">
        <div class="col">
          <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center">
              <th:block th:if="${pageMaker.prev}">
                <li class="page-item">
                  <a class="page-link" th:href="|/product/pro_list${pageMaker.makeSearch(pageMaker.startPage - 1)}&cate_code=${cate_code}|">Ïù¥Ï†Ñ</a>
                </li>
              </th:block>

              <th:block th:each="num : ${#numbers.sequence(pageMaker.startPage, pageMaker.endPage)}">
                <li class="page-item" th:classappend="${pageMaker.cri.page == num} ? 'active'">
                  <a class="page-link" th:href="|/product/pro_list${pageMaker.makeSearch(num)}&cate_code=${cate_code}|" th:text="${num}"></a>
                </li>
              </th:block>

              <th:block th:if="${pageMaker.next}">
                <li class="page-item">
                  <a class="page-link" th:href="|/product/pro_list${pageMaker.makeSearch(pageMaker.endPage + 1)}&cate_code=${cate_code}|">Îã§Ïùå</a>
                </li>
              </th:block>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </th:block>

  <th:block layout:fragment="script2">
    <script th:inline="javascript">
      $(document).ready(function () {
        $("button[name='brn_cart_add']").on("click", function () {
          let item_num = $(this).data("item_num");
          let cart_amount = $(this).closest(".product-card").find("input[name='quantity']").val();

          $.ajax({
            url: "/cart/cart_add",
            type: "post",
            data: { item_num: item_num, cart_amount: cart_amount },
            dataType: "text",
            success: function (data) {
              if (data === "success") {
                alert("Ïû•Î∞îÍµ¨ÎãàÏóê Îì±Î°ùÎêòÏóàÏäµÎãàÎã§.");
                if (confirm("Ïû•Î∞îÍµ¨ÎãàÎ°ú Ïù¥ÎèôÌïòÏãúÍ≤†ÏäµÎãàÍπå?")) {
                  location.href = "/cart/cart_list";
                }
              } else {
                alert("Ïû•Î∞îÍµ¨Îãà Îì±Î°ù Ïã§Ìå®");
              }
            }
          });
        });

        $("a.pro_info").on("click", function (e) {
          e.preventDefault();
          let item_num = $(this).data("item_num");
          let cate_name = encodeURIComponent([[${cate_name}]]);
          location.href = `/product/pro_detail?item_num=${item_num}&cate_name=${cate_name}`;
        });

        $("button[name='btn_buy_add']").on("click", function () {
          let item_num = $(this).data("item_num");
          let cart_amount = $(this).closest(".product-card").find("input[name='quantity']").val();
          location.href = `/order/order_info?item_num=${item_num}&cart_amount=${cart_amount}&type=buy`;
        });
      });
    </script>
  </th:block>
</html>
