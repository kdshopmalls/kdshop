<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/layout}">
    <th:block layout:fragment="css">
      <style>
      a.pro_info{
      	text-decoration: none;
  		color: inherit;
  	  }
  	  </style>
      </th:block>	
<th:block layout:fragment="content">
<div class="row">
	<div class="col text-center md-3 mt-3">
		<h3 th:utext="${cate_name}"></h3> 
	</div> 
</div>
<div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3"> 
		<div class="col" th:each="productDTO:${secodCateGoryList}"> 
			<div class="card shadow-sm h-100">
      <!-- ìƒí’ˆ ì´ë¯¸ì§€ -->
      <a href="#"  class="pro_info" th:data-item_num="${productDTO.item_num}">
      <img th:src="|/product/image_display?dateFolderName=${productDTO.item_up_folder}&fileName=s_${productDTO.item_img}|" 
           class="card-img-top" 
           alt="ìƒí’ˆ ì´ë¯¸ì§€" 
           height="255" 
           style="object-fit: cover;">
	  </a>
      <div class="card-body d-flex flex-column">
        <!-- ìƒí’ˆ ì œëª© -->
        <a href="#"  class="pro_info" th:data-item_num="${productDTO.item_num}">
        <h5 class="card-title mb-2" th:text="${productDTO.item_name}">ìƒí’ˆ ì œëª©</h5>
		</a>
        <!-- ìƒí’ˆ ê°€ê²© -->
        <p class="card-text mb-1">
          <strong th:text="${#numbers.formatInteger(productDTO.item_price, 3, 'COMMA')}"></strong> ì›
        </p>

        <!-- ìƒí’ˆ ìˆ˜ëŸ‰ í‘œì‹œ -->
        <p class="card-text mb-2"
           th:classappend="${productDTO.item_amount == 0} ? 'text-danger fw-bold' : 'text-muted'">
          <span th:if="${productDTO.item_amount > 0}">
            ì¬ê³ : <span th:text="${productDTO.item_amount}"></span> ê°œ
          </span>
          <span th:if="${productDTO.item_amount == 0}">
            í’ˆì ˆ
          </span>
        </p>

        <!-- êµ¬ë§¤ ìˆ˜ëŸ‰ ì„ íƒ (ì¬ê³  ìˆì„ ë•Œë§Œ) -->
       <div class="mb-3" th:if="${productDTO.item_amount > 0}">
        <div class="d-flex align-items-center">
          <label class="form-label small me-2 mb-0">êµ¬ë§¤ ìˆ˜ëŸ‰</label>
          <input type="number" 
                class="form-control form-control-sm" 
                name="quantity"
                value="1"
                min="1" 
                th:attr="max=${productDTO.item_amount}"
                style="width: 100px;" />
        </div>
      </div>
        <!-- ë²„íŠ¼ ì˜ì—­ -->
        <div class="mt-auto d-flex justify-content-between">
          <!-- ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸° -->
          <form th:action="@{/cart/add}" method="post" class="d-inline w-50 me-1">
            <input type="hidden" name="item_num" th:value="${productDTO.item_num}">
            <input type="hidden" name="quantity" value="1" class="selected-qty">
            <button type="button" name="brn_cart_add" th:data-item_num="${productDTO.item_num}" class="btn btn-outline-primary btn-sm w-100">ğŸ›’ ì¥ë°”êµ¬ë‹ˆ</button>
          </form>

          <!-- êµ¬ë§¤í•˜ê¸° -->
          <form th:action="@{/order/now}" method="post" class="d-inline w-50">
            <input type="hidden" name="item_num" th:value="${productDTO.item_num}">
            <input type="hidden" name="quantity" value="1" class="selected-qty">
            <button type="submit" class="btn btn-success btn-sm w-100">ğŸ’³ êµ¬ë§¤í•˜ê¸°</button>
          </form>
        </div>
      </div>
    </div>
		</div>

	</div>
	


	
	
	 <div class="row  mt-3">
	  		<div class="col">
		  		<nav aria-label="Page navigation example">
				  <ul class="pagination justify-content-center" >
				  	<th:block th:if="${pageMaker.prev}">
				    <li class="page-item"><a class="page-link" th:href="|/product/pro_list${pageMaker.makeSearch(pageMaker.startPage-1 )}&cate_code=${cate_code}|">Previous</a></li>
				    </th:block>
				    <th:block th:each="num:${#numbers.sequence(pageMaker.startPage, pageMaker.endPage)}">
				   	 <li class="page-item" th:classappend="${pageMaker.cri.page==num ? 'active':''}"><a class="page-link" th:href="|/product/pro_list${pageMaker.makeSearch(num)}&cate_code=${cate_code}|" th:text="${num}"></a></li>
				    </th:block>
				    <th:block th:if="${pageMaker.next}">
				    <li class="page-item"><a class="page-link" th:href="|/product/pro_list${pageMaker.makeSearch(pageMaker.endPage+1 )}&cate_code=${cate_code}|">Next</a></li>
				    </th:block>
				  </ul>
				</nav>
	  		</div>
	  		
		
		
	  </div>	
</th:block>	
<th:block layout:fragment="script2">
  <script th:inline="javascript">
        $(document).ready(function(){
        //ì¥ë°”êµ¬ë‹ˆë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì„¤ì • 
        $("button[name='brn_cart_add']").on("click",function(){
            let item_num = $(this).data("item_num");
            //í˜„ì¬ ì„ íƒí•œ ì¥ë°”êµ¬ë‹ˆ íƒœê·¸$(this) ì—ì„œ ì¥ë°”êµ¬ë‹ˆë²„íŠ¼íƒœê·¸ì™€ ìˆ˜ëŸ‰íƒœê·¸ë¥¼  ê°ì‹¸ëŠ” ë¶€ëª¨í…Œê·¸ë¥¼ ê°ì‚¬ëŠ” ë¶€ëª¨í…Œê·¸ div.cardë¡œ ìœ„ì¹˜ë¥¼ ì´ë™í•˜ì—¬
            // find()ë©”ì„œë“œë¡œ ìˆ˜ëŸ‰ íƒœê·¸ë¥¼ ì°¾ì•„ ,í˜„ì¬ ìˆ˜ëŸ‰ê°’ì„ ì½ì–´ì˜¨ë‹¤
            let cart_amount = $(this).parents("div.card").find("input[name='quantity']").val();

            //console.log("ìƒí’ˆì½”ë“œ",pro_num);
            //console.log("ìˆ˜ëŸ‰",cart_amount);
            $.ajax({
               url:'/cart/cart_add',
               type:'post',
               data: {item_num:item_num,cart_amount:cart_amount},
               dataType:'text',
               success:function(data){
                if(data == "success"){
                  alert("ì¥ë°”êµ¬ë‹ˆì— ë“±ë¡ë¨");
                  if(confirm("ì¥ë°”êµ¬ë‹ˆë¡œ ì´ë™í•˜ê² ìŠµë‹ˆê¹Œ?")){
                    location.href="/cart/cart_list";
                  }
                }
               }
            });
        });
        //ìƒí’ˆì´ë¯¸ì§€ í´ë¦­
        $("a.pro_info").on("click",function(e){
          e.preventDefault();
          let item_num = $(this).data("item_num");
          let cate_name = encodeURIComponent([[${cate_name}]]);
          /*let cate_name = 'ì¹´í˜ê³ ë¦¬';*/
          location.href=`/product/pro_detail?item_num=${item_num}&cate_name=${cate_name}`;

        });

    });
  </script>
</th:block>
</html>