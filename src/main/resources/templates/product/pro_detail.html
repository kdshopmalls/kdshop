<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/layout}">
	<th:block layout:fragment="script1">
		<script src="https://code.jquery.com/ui/1.14.1/jquery-ui.js"></script>
		<script>
			$(document).ready(function(){
				$("#tabs").tabs();
				
			});
		</script>
	</th:block>
	<th:block layout:fragment="css">
		<link rel="stylesheet" href="https://code.jquery.com/ui/1.14.1/themes/base/jquery-ui.css">
	</th:block>
<th:block layout:fragment="content">
<h3>상품상세 </h3>
	<div class="row">
    <div class="col text-center mb-3 mt-3">
      <h3 th:utext="${cate_name}"></h3>
    </div>
  </div>
  <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3">        
    <div class="col-6">
      <img style="width: 100%;height: 280px;" th:src="${'/product/image_display?dateFolderName=' + productDTO.item_up_folder + '&fileName=' + productDTO.item_img}">
    </div>
    <div class="col-6">
      <h5 th:text="${productDTO.item_name}"></h5>
      <div class="mt-3">할인율 <span th:text="${productDTO.item_discount}"></span></div>
      <div class="mt-3">판매가격 <span>[[${#numbers.formatInteger(productDTO.item_price, 3, 'COMMA') + '원'}]]</span></div>
      <div class="mt-3">제조사 <span th:text="${productDTO.item_publisher}"></span></div>
      <div class="mt-3">수량 <input type="number" value="1" id="cart_amount"></div>
      <div class="d-flex justify-content-between align-items-center mt-5">
        <div class="btn-group">
          <button type="button" class="btn btn-outline-primary" id="btn_cart_add">Cart</button> 
          <button type="button" class="btn btn-outline-primary" id="btn_buy_add">Buy</button>
        </div>
        <small class="text-body-secondary">상품후기 :   <span id="review_count" th:text="${productDTO.item_review}"></span></small>
      </div>
    </div>
  </div>
  <div class="row mt-5">
    <div id="tabs">
      <ul>
        <li><a href="#tabs-1">상세정보</a></li>
        <li><a href="#tabs-2">리뷰</a></li>
        <li><a href="#tabs-3">QnA</a></li>
      </ul>
      <div id="tabs-1">
        <p>상세내용</p>
        <p th:utext="${productDTO.item_content}"></p>
      </div>
      <div id="tabs-2">
        <div class="row mt-3 mb-3">
          <div class="col-10">
            <textarea class="form-control" id="rev_content" rows="3"></textarea>
          </div>
          <div class="col-2">
            <p id="star_rev_rate">
              <a class="rev_rate" href="#">☆</a>
              <a class="rev_rate" href="#">☆</a>
              <a class="rev_rate" href="#">☆</a>
              <a class="rev_rate" href="#">☆</a>
              <a class="rev_rate" href="#">☆</a>
              (별평점)
            </p>
            <button type="button" class="btn btn-primary mb-2" id="btn_rev_save" th:data-item_num="${productDTO.item_num}">후기 작성하기</button>
          </div>
        </div>
        <div class="row">
          <!-- 상품후기목록이 출력되는 위치 -->
          <div class="col" id="reviewList"></div>
        </div>
        <div class="row">
          <!-- 상품 페이지 출력되는 위치 [prev] 1 2 3 4 5 [next]-->
          <div class="col" id="reviewPaging"></div>
        </div>
      </div>
      <div id="tabs-3">
        <p>QnA</p>
      </div>
    </div>
  </div>
</th:block>
<th:block layout:fragment="script2">
    <script>
      $(document).ready(function(){
        //장바구니 버튼 클릭 btn_cart_add
        $("button#btn_cart_add").on("click",function(){
          $.ajax({
            url:'/cart/cart_add',
            type:'post',
            data:{item_num:[[${productDTO.item_num}]],cart_amount:$(#cart_amount).val()},
            dataType:'text',
            success:function(result){
              if(result=="success"){
                alert("장바구니에 등록됨");
                if(confirm("장바구니로 이동하시겠습니가?")){
                  location.href=""cart/cart_list;
                }
              }
            }
          });
        });
        //구매하기 버튼 클릭 btn_buy_add
         $("button#btn_buy_add").on("click",function(){
             let cart_cmount=$(#cart_amount).val();
             let url=`/order/order_info?item_num=[[${productDTO.item_num}]]&cart_amount:${cart_amount}&type=buy`;
             location.href = url;
        });
      });
    </script>
</th:block>
</html>