<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layouts/layout}">
  <th:block layout:fragment="content">
    <style>
      .cart-container {
        background-color: #ffffff;
        border-radius: 16px;
        padding: 30px;
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.08);
        animation: fadeIn 1s ease-in-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .table th,
      .table td {
        vertical-align: middle !important;
        text-align: center;
      }

      .table thead {
        background-color: #f1f3f5;
      }

      h3 {
        font-weight: 800;
        color: #2c3e50;
        animation: slideInDown 0.8s ease-out;
      }

      @keyframes slideInDown {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .cart-image {
        width: 100px;
        height: 100px;
        object-fit: cover;
        border-radius: 10px;
        border: 1px solid #ddd;
        transition: transform 0.3s ease;
      }

      .cart-image:hover {
        transform: scale(1.05);
      }

      .btn-custom {
        border-radius: 20px;
        padding: 6px 16px;
        font-weight: 500;
        transition: all 0.2s ease;
      }

      .btn-custom:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
      }

      .total-price {
        font-size: 1.25rem;
        font-weight: 700;
        color: black;
      }

      tr[th\\:each] {
        animation: rowFadeIn 0.6s ease forwards;
        opacity: 0;
      }

      @keyframes rowFadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>

    <div class="row justify-content-center mt-4">
      <div class="col-11 cart-container">
        <div class="text-center mb-4">
          <h3><i class="fas fa-shopping-cart"></i> 장바구니</h3>
        </div>

        <form id="cartForm" method="post" action="/cart/cart_sel_delete">
          <table class="table table-hover">
            <thead class="thead-light">
              <tr>
                <th><input type="checkbox" id="checkAll" /></th>
                <th>상품 이미지</th>
                <th>상품 이름</th>
                <th>가격</th>
                <th>수량</th>
                <th>합계</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="item : ${cart_list}">
                <td><input type="checkbox" name="check" th:value="${item['item_num']}" /></td>
                <td>
                  <img class="cart-image" th:src="${'/cart/image_display?dateFolderName=' + item.item_up_folder + '&fileName=s_' + item.item_img}" />
                </td>
                <td th:text="${item['item_name']}"></td>
                <td th:text="${#numbers.formatInteger(item['item_price'], 3, 'COMMA') + ' 원'}"></td>
                <td>
                  <div class="d-flex justify-content-center align-items-center">
                    <input type="number" name="btn_cart_amount" min="1" th:value="${item['cart_amount']}" class="form-control text-center" style="width: 60px" />
                    <button type="button" class="btn btn-success btn-sm btn-custom ml-2" name="btn_quantity_change" th:data-item_num="${item['item_num']}">변경</button>
                  </div>
                </td>
                <td th:text="${#numbers.formatInteger(item['unitprice'], 3, 'COMMA') + ' 원'}"></td>
              </tr>
            </tbody>
            <tfoot>
              <tr>
                <td colspan="6" class="text-right">
                  <div th:if="${cart_total_price != null}" class="total-price" th:text="'총 금액 : ' + ${#numbers.formatInteger(cart_total_price, 3, 'COMMA') + ' 원'}"></div>
                  <div th:unless="${cart_total_price != null}" class="text-muted">장바구니가 비었습니다</div>
                </td>
              </tr>
            </tfoot>
          </table>
        </form>

        <div class="d-flex justify-content-between mt-4">
          <div>
            <button type="button" class="btn btn-secondary btn-custom" id="btn_sel_delete">선택 삭제</button>
            <button type="button" class="btn btn-danger btn-custom" id="btn_cart_empty">장바구니 비우기</button>
          </div>
          <div>
            <button type="button" class="btn btn-success btn-custom" id="btn_order_info">주문하기</button>
          </div>
        </div>
      </div>
    </div>
  </th:block>

  <th:block layout:fragment="script2">
    <script th:inline="javascript">
      $(document).ready(function () {
        $("#btn_cart_empty").on("click", function () {
          if (!confirm("장바구니를 비우겠습니까?")) return;
          location.href = "/cart/cart_empty";
        });

        $("#checkAll").on("click", function () {
          $("input[name='check']").prop("checked", this.checked);
        });

        $("input[name='check']").on("click", function () {
          let allChecked = $("input[name='check']").length === $("input[name='check']:checked").length;
          $("#checkAll").prop("checked", allChecked);
        });

        $("#btn_sel_delete").on("click", function () {
          if (!confirm("선택한 상품을 삭제하시겠습니까?")) return;
          $("#cartForm").submit();
        });

        $("button[name='btn_quantity_change']").on("click", function () {
          let item_num = $(this).data("item_num");
          let cart_amount = $(this).closest("td").find("input[name='btn_cart_amount']").val();
          location.href = "/cart/cart_quantity_change?item_num=" + item_num + "&cart_amount=" + cart_amount;
        });

        $("#btn_order_info").on("click", function () {
          location.href = "/order/order_info?type=cart";
        });
      });
    </script>
  </th:block>
</html>
