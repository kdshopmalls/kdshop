<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layouts/layout}">
  <th:block layout:fragment="script1"> </th:block>
  <th:block layout:fragment="css"> </th:block>

  <th:block layout:fragment="content">
    <h1 class="mt-3 mb-4 text-center text-dark fw-bold">수정하기</h1>
    <div class="row">
      <div class="col">
        <div class="card card-info border border-primary shadow">
          <div class="card-header bg-primary text-white">
            <h3 class="card-title">회원수정</h3>
          </div>

          <form class="form-horizontal" id="modifyForm" action="/member/modify" method="post">
            <div class="card-body">
              <div class="form-group row mb-3">
                <label for="mb_id" class="col-sm-2 col-form-label">아이디</label>
                <div class="col-sm-4">
                  <input type="text" class="form-control" id="mb_id" name="mb_id" th:value="${memberDTO.mb_id}" readonly />
                </div>
                <label for="mb_datesub" class="col-sm-2 col-form-label">가입일</label>
                <div class="col-sm-4">
                  <span th:text="${#dates.format(memberDTO.mb_datesub, 'yyyy-MM-dd HH:mm:ss')}"></span>
                </div>
              </div>

              <div class="form-group row mb-3">
                <label for="mb_name" class="col-sm-2 col-form-label">이름</label>
                <div class="col-sm-4">
                  <input type="text" class="form-control" id="mb_name" name="mb_name" th:value="${memberDTO.mb_name}" />
                </div>
                <label for="mb_updatedate" class="col-sm-2 col-form-label">수정일</label>
                <div class="col-sm-4">
                  <span th:text="${#dates.format(memberDTO.mb_updatedate, 'yyyy-MM-dd HH:mm:ss')}"></span>
                </div>
              </div>

              <div class="form-group row mb-3">
                <label for="mb_email" class="col-sm-2 col-form-label">전자우편</label>
                <div class="col-sm-4">
                  <input type="text" class="form-control" id="mb_email" name="mb_email" th:value="${memberDTO.mb_email}" />
                </div>
                <label for="mb_nick" class="col-sm-2 col-form-label">별명</label>
                <div class="col-sm-4">
                  <input type="text" class="form-control" id="mb_nick" name="mb_nick" th:value="${memberDTO.mb_nick}" />
                </div>
              </div>

              <div class="form-group row mb-3">
                <label for="mb_zipcode" class="col-sm-2 col-form-label">우편번호</label>
                <div class="col-sm-4">
                  <input type="text" class="form-control" id="sample2_postcode" name="mb_zipcode" th:value="${memberDTO.mb_zipcode}" />
                </div>
                <div class="col-sm-4">
                  <button type="button" class="btn btn-outline-primary" onclick="sample2_execDaumPostcode()">우편번호</button>
                </div>
              </div>

              <div class="form-group row mb-3">
                <label for="sample2_address" class="col-sm-2 col-form-label">기본주소</label>
                <div class="col-sm-4">
                  <input type="text" class="form-control" id="sample2_address" name="mb_addr" th:value="${memberDTO.mb_addr}" />
                </div>
                <label for="sample2_extraAddress" class="col-sm-2 col-form-label">나머지주소</label>
                <div class="col-sm-4">
                  <input type="text" class="form-control" id="sample2_detailAddress" name="mb_deaddr" th:value="${memberDTO.mb_deaddr}" />
                  <input type="hidden" id="sample2_extraAddress" placeholder="참고항목" />
                </div>
              </div>

              <div class="form-group row mb-3">
                <label for="mb_phone" class="col-sm-2 col-form-label">연락처</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="mb_phone" name="mb_phone" th:value="${memberDTO.mb_phone}" />
                </div>
              </div>
            </div>

            <!-- 버튼 영역 -->
            <div class="card-footer text-center">
              <button type="button" class="btn btn-primary" id="btnModify">수정</button>
              <button type="button" class="btn btn-secondary float-right" id="btnCancel">취소</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- 우편번호 레이어 -->
    <div id="layer" style="display: none; position: fixed; overflow: hidden; z-index: 1; -webkit-overflow-scrolling: touch">
      <img
        src="//t1.daumcdn.net/postcode/resource/images/close.png"
        id="btnCloseLayer"
        style="cursor: pointer; position: absolute; right: -3px; top: -3px; z-index: 1"
        onclick="closeDaumPostcode()"
        alt="닫기 버튼"
      />
    </div>

    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script>
      var element_layer = document.getElementById("layer");

      function closeDaumPostcode() {
        element_layer.style.display = "none";
      }

      function sample2_execDaumPostcode() {
        new daum.Postcode({
          oncomplete: function (data) {
            var addr = "";
            var extraAddr = "";

            if (data.userSelectedType === "R") {
              addr = data.roadAddress;
            } else {
              addr = data.jibunAddress;
            }

            if (data.userSelectedType === "R") {
              if (data.bname !== "" && /[동|로|가]$/g.test(data.bname)) {
                extraAddr += data.bname;
              }
              if (data.buildingName !== "" && data.apartment === "Y") {
                extraAddr += extraAddr !== "" ? ", " + data.buildingName : data.buildingName;
              }
              if (extraAddr !== "") {
                extraAddr = " (" + extraAddr + ")";
              }
              document.getElementById("sample2_extraAddress").value = extraAddr;
            } else {
              document.getElementById("sample2_extraAddress").value = "";
            }

            document.getElementById("sample2_postcode").value = data.zonecode;
            document.getElementById("sample2_address").value = addr;
            document.getElementById("sample2_detailAddress").focus();
            element_layer.style.display = "none";
          },
          width: "100%",
          height: "100%",
          maxSuggestItems: 5,
        }).embed(element_layer);

        element_layer.style.display = "block";
        initLayerPosition();
      }

      function initLayerPosition() {
        var width = 300;
        var height = 400;
        var borderWidth = 5;

        element_layer.style.width = width + "px";
        element_layer.style.height = height + "px";
        element_layer.style.border = borderWidth + "px solid";
        element_layer.style.left = ((window.innerWidth || document.documentElement.clientWidth) - width) / 2 - borderWidth + "px";
        element_layer.style.top = ((window.innerHeight || document.documentElement.clientHeight) - height) / 2 - borderWidth + "px";
      }
    </script>

    <!-- 수정 및 취소 버튼 동작 스크립트 -->
    <script>
      $(document).ready(function () {
        $("#btnModify").on("click", function () {
          $("#modifyForm").submit();
        });

        $("#btnCancel").on("click", function () {
          location.href = "/";
        });
      });
    </script>
  </th:block>
</html>
